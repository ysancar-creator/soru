<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yapay Zeka Destekli Pil Sorusu Değerlendirme</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter font ailesini yükleyelim */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* Değerlendirme kutuları için stiller */
        .evaluation-box {
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 0.75rem;
            border: 1px solid transparent;
        }
        .evaluation-box.correct {
            background-color: #F0FDF4; /* green-50 */
            border-color: #BBEFBD; /* green-200 */
        }
        .evaluation-box.partial {
            background-color: #FFFBEB; /* yellow-50 */
            border-color: #FEF08A; /* yellow-200 */
        }
        .evaluation-box.incorrect {
            background-color: #FEF2F2; /* red-50 */
            border-color: #FECACA; /* red-200 */
        }
        .evaluation-box h4 {
            font-weight: 600;
        }
        .evaluation-box.correct h4 { color: #15803D; /* green-700 */ }
        .evaluation-box.partial h4 { color: #B45309; /* yellow-700 */ }
        .evaluation-box.incorrect h4 { color: #B91C1C; /* red-700 */ }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">

    <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-lg overflow-hidden">
        <header class="p-6 bg-gradient-to-r from-blue-600 to-indigo-700 text-white">
            <h1 class="text-2xl md:text-3xl font-bold">Elektronik Devreler: Pil Bağlantıları</h1>
            <p class="mt-1 text-blue-100">Yapay Zeka Değerlendirme Aracı</p>
        </header>

        <main class="p-6">
            <div class="grid md:grid-cols-2 gap-6">
                
                <!-- Sol Sütun: Resim ve Bilgi -->
                <div>
                    
                    <!-- Görsel (d.jpg) -->
                    <img src="d.jpg" alt="Pil tutucu ve piller" class="rounded-lg shadow-md w-1/2 mx-auto mb-4">
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-800 mb-2">Bilgi</h2>
                        <p class="text-gray-700 leading-relaxed">
                            Pille çalışan elektronik aletlerin içinde yer alan pil tutucular, pillerin güvenli bir şekilde yerleştirilerek sabitlenmesini ve devreye doğru şekilde bağlanmasını sağlar. Şekilde gösterildiği gibi pil tutucunun içerisinde bulunan tel, kutupları birbirine bağlamaktadır.
                        </p>
                    </div>
                </div>

                <!-- Sağ Sütun: Sorular ve Değerlendirme Kutuları -->
                <div>
                    
                    <!-- Soru A -->
                    <div class="mb-6">
                        <label for="answer-a" class="block text-lg font-semibold text-gray-900 mb-2">
                            a) Görselde verilen pil tutucunun içerisine yerleştirilecek piller ne şekilde bağlanmış olur? Açıklayınız.
                        </label>
                        <textarea id="answer-a" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" placeholder="Cevabınızı buraya yazınız..."></textarea>
                        
                        <!-- Soru A için Değerlendirme Kutusu (Başlangıçta gizli) -->
                        <div id="result-box-a" class="evaluation-box hidden">
                            <h4>Değerlendirme (a):</h4>
                            <p class="mt-2 text-gray-700"></p>
                        </div>
                    </div>

                    <!-- Soru B -->
                    <div class="mb-6">
                        <label for="answer-b" class="block text-lg font-semibold text-gray-900 mb-2">
                            b) Bu bağlanma şeklinin avantajları ve dezavantajları nelerdir? Açıklayınız.
                        </label>
                        <textarea id="answer-b" rows="5" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition" placeholder="Cevabınızı buraya yazınız..."></textarea>
                        
                        <!-- Soru B için Değerlendirme Kutusu (Başlangıçta gizli) -->
                        <div id="result-box-b" class="evaluation-box hidden">
                            <h4>Değerlendirme (b):</h4>
                            <p class="mt-2 text-gray-700"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer: Buton ve Hata Kutusu -->
            <footer class="mt-6 pt-6 border-t border-gray-200">
                
                <!-- Genel Değerlendirme Kutusu -->
                <div id="overall-result-box" class="evaluation-box hidden mb-4">
                    <h4>Genel Değerlendirme:</h4>
                    <p class="mt-2 text-gray-700"></p>
                </div>
                
                <div class="flex items-center justify-end gap-4">
                    
                    <!-- Hata Mesajı Kutusu (Başlangıçta gizli) -->
                    <div id="error-box" class="evaluation-box incorrect hidden flex-1">
                        <h4>Hata:</h4>
                        <p class="mt-2 text-gray-700"></p>
                    </div>
                    <button id="evaluate-button" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 disabled:opacity-50">
                        Değerlendir
                    </button>
                </div>
            </footer>
        </main>
    </div>

    <script type="module">
        // --- DOM Elementleri ---
        const button = document.getElementById('evaluate-button');
        const answerA = document.getElementById('answer-a');
        const answerB = document.getElementById('answer-b');
        
        const resultBoxA = document.getElementById('result-box-a');
        const resultBoxB = document.getElementById('result-box-b');
        const overallBox = document.getElementById('overall-result-box');
        const errorBox = document.getElementById('error-box');

        // --- Değerlendirme Statüsüne Göre Renk Ayarlama Fonksiyonu ---
        function setBoxStatus(box, status) {
            box.classList.remove('correct', 'partial', 'incorrect');
            if (status === 'Doğru') {
                box.classList.add('correct');
            } else if (status === 'Kısmen Doğru') {
                box.classList.add('partial');
            } else {
                box.classList.add('incorrect');
            }
        }

        // --- Buton Tıklama Olayı ---
        button.addEventListener('click', async () => {
            const studentAnswerA = answerA.value;
            const studentAnswerB = answerB.value;

            // Butonu kilitle ve durumu "Değerlendiriliyor..." yap
            button.disabled = true;
            button.innerText = 'Değerlendiriliyor...';
            
            // Hata ve sonuç kutularını temizle/gizle
            errorBox.classList.add('hidden');
            resultBoxA.classList.add('hidden');
            resultBoxB.classList.add('hidden');
            overallBox.classList.add('hidden'); // Bu satırı ekledim

            try {
                // 1. Bizim "Aracı Sunucumuza" (Vercel) isteği gönder
                const response = await fetch('/api/evaluate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        studentAnswerA: studentAnswerA,
                        studentAnswerB: studentAnswerB
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // 2. Başarılı Değerlendirme (Sunucudan 200 OK geldi)
                    // BU KOD, 'undefined' HATASINI ÇÖZMEK İÇİN GÜNCELLENDİ
                    const { evaluationA, evaluationB, overallStatus } = data; // overallStatus eklendi (varsa)

                    // 'data'nın kendisinin undefined olup olmadığını kontrol et
                    if (!evaluationA || !evaluationB) {
                        throw new Error('Sunucudan beklenen veri yapısı alınamadı.');
                    }

                    // A Kutusu
                    resultBoxA.classList.remove('hidden');
                    setBoxStatus(resultBoxA, evaluationA.status);
                    resultBoxA.querySelector('h4').innerText = `Değerlendirme (a): ${evaluationA.status || 'Hata'}`;
                    resultBoxA.querySelector('p').innerText = evaluationA.feedback || 'Geri bildirim alınamadı.';
                    
                    // B Kutusu
                    resultBoxB.classList.remove('hidden');
                    setBoxStatus(resultBoxB, evaluationB.status);
                    resultBoxB.querySelector('h4').innerText = `Değerlendirme (b): ${evaluationB.status || 'Hata'}`;
                    resultBoxB.querySelector('p').innerText = evaluationB.feedback || 'Geri bildirim alınamadı.';
                    
                    // Genel Durum Kutusu (varsa)
                    if (overallStatus) {
                        overallBox.classList.remove('hidden');
                        setBoxStatus(overallBox, overallStatus);
                        overallBox.querySelector('h4').innerText = `Genel Durum: ${overallStatus}`;
                    }

                } else {
                    // 3. Sunucu Hata Döndürdü (örn: 500)
                    throw new Error(data.error || 'Bilinmeyen bir sunucu hatası oluştu.');
                }

            } catch (error) {
                // 4. Ağ Hatası veya JSON Parse Hatası ("The string did not match...")
                console.error("Değerlendirme hatası:", error);
                errorBox.classList.remove('hidden');
                // Hata mesajını "undefined" değil, detaylı göster
                errorBox.querySelector('p').innerText = error.message || 'Değerlendirme yapılamadı. Ağ bağlantısını kontrol edin.';
            } finally {
                // Sonuç ne olursa olsun butonu tekrar aç
                button.disabled = false;
                button.innerText = 'Değerlendir';
            }
        });
    </script>
</body>
</html>
